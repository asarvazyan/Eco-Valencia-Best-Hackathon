 <!DOCTYPE html>
<html>
    <head>
    	<!-- Leaflet CSS and JS--->
                <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" 
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>
        <title>Eco-Valencia</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <header>
            <div>
                <h1>Eco-Valencia</h1>
            </div>
            <div class="menu">
                <a href='index.html'>Inicio</a>
                <a href='info.html'>Informacion</a>
                <a href='search.html'>Buscador</a>
                <a id='here' href='map.html'>Mapa</a>
                <a href='trade.html'>Canjear</a>
                <a href='user.html'>Perfil</a>
            </div>
        </header>
        
        
        <!-- MAIN -->
        <div id='map'>
            <div id="mapid" style="width: 600px; height: 400px;"></div>
			<script>

				var mymap = L.map('mapid').setView([39.46, -0.3666667], 12);

				L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
					maxZoom: 18,
					attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
						'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
					id: 'mapbox/streets-v11',
					tileSize: 512,
					zoomOffset: -1
				}).addTo(mymap);
				
				var types = ['aceite', 'pila', 'plastico', 'papel', 'vidrio'];

				var myPoints = [
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "vidrio"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3789236268807361, 39.47093653238205]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "papel"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3702976426888416, 39.474871520398736]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "plastico"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3890516481209705, 39.47728419205835]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "aceite"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3775503358651111, 39.48010696684263]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "pila"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.40008089159020876, 39.46744637011887]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "vidrio"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3803398332405994, 39.49003794000522]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "papel"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3685810289193103, 39.485699730803624]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "plastico"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.36742231462487673, 39.45624917237179]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "aceite"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3890516481209705,39.49358326816988] 
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "pila"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.41930696580895876, 39.47337915430027]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "plastico"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3377678117562244, 39.469569972395334]
		   	 				}
						},
						{
		    				"type": "Feature",
		   					"properties": 
		   					{
		        			"tipo_resid": "aceite"
		    				},
		    				"geometry": 
		    				{
		        			"type": "Point",
		        			"coordinates": [-0.3297855577279041,39.479144154635904] 
		   	 				}
						}
				];

				
				function getColor(d) {
					if (d === 'aceite')
						return '#E62100';
					else if (d === 'pila')
						return '#1F78B4';
					else if (d === 'plastico')
						return '#FBCC0A';
					else if (d === 'papel')
							return '#152A92';
					else if (d === 'vidrio')
						return '#00E621';
					else
						return '#AAAAAA';
				}
				

				L.geoJSON(myPoints, {
					    pointToLayer: function (feature, latlng) {
					    	console.log(feature.properties.tipo_resid);
					        return L.circleMarker(latlng, {radius: 10, fillColor: getColor(feature.properties.tipo_resid), fillOpacity: 0.8, weight: 1, opacity: 1});
					    }
					}).addTo(mymap);

				
				var legend = L.control({position: 'bottomright'});
				    legend.onAdd = function (map) {

				    var div = L.DomUtil.create('div', 'info legend');
				    labels = ['<strong>Categorías</strong>'],
				    categories = ['aceite', 'pila', 'plastico', 'papel', 'vidrio'];

				    for (var i = 0; i < categories.length; i++) {

				            div.innerHTML += 
				            labels.push(
				                '<div id="kk"><div id="categoria" style = "background-color: ' +  getColor(categories[i]) + '"></div><div>' +
				            (categories[i] ? categories[i] : '+') + '</div></div> ' );

				        }
				        div.innerHTML = labels.join('');
				    return div;
				    };

				legend.addTo(mymap);
	
				// getContainers is only used with data... not called yet.
				function getContainers(type) {
					// Get map in JSON form
					var mapObj = getData();
					// Parse JSON and only store containers of given type
					var mapFeatures = mapObj.features;
					var mapType = mapFeatures.filter(function (entry) {
						return entry.properties.tipo_resid === type; 
					}); 
					//TODO
					// for each entry get coordinates
					//mapType = mapType.
					// transform to latlong

					// set coordinates as latlong
				
					return mapType;
				}

				// getData is only used with data... not called yet.
				function getData() {
					var mapObj = null;
					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function() {
						if (this.readyState == 4 && this.status == 200) {
							mapObj = JSON.parse(this.responseText);
							//document.getElementById("mapa").innerHTML = mapObj.features;
							//console.log(mapObj.features);
						}
					};
					xmlhttp.open('GET', 'http://mapas.valencia.es/lanzadera/opendata/res_contenedor/JSON', false);
					xmlhttp.send();
					return mapObj;
				}

			</script>
        </div>
        
        <footer>
            <div>
                <p>Tel. (+34) 555 - 555 - 555</p>
            </div>
            <div>
                <img alt='facebook' src="img/fb.png">
                <img alt='twitter' src="img/tw.png">
                <img alt='instagram' src="img/in.png">
                <img alt='mail' src="img/mail.png">
            </div>
        </footer>
    </body>
</html>
 <!DOCTYPE html>
<html>
    <head>
        <!-- Leaflet CSS and JS--->
         <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" 
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>
        <title>Eco-Valencia</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" type="text/css" href="search.css">
        <link rel="stylesheet" type="text/css" href="map.css">
		

    </head>
    <body>
        <header>
            <div>
                <p>Eco-Valencia</p>
            </div>
            <div class="menu">
                <a href='#'>Inicio</a>
                <a href='#'>Informacion</a>
                <a href='#'>Buscador</a>
                <a href='#'>Mapa</a>
                <a href='#'>Canjear</a>
                <a href='#'>Perfil</a>
            </div>
        </header>
      
        
        <!-- CUERPO -->
        <div>
            <div id="mapid" style="width: 600px; height: 400px;"></div>
			<script>
				var types = ['Envases Ligeros', 'Organico', 'Papel \/ Carton', 'VIDRIO'];

				var mymap = L.map('mapid').setView([39.46, -0.3666667], 12);

				L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
					maxZoom: 18,
					attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
						'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
					id: 'mapbox/streets-v11',
					tileSize: 512,
					zoomOffset: -1
				}).addTo(mymap);
				// Point styling
				var geojsonMarkerOptions = {
				    radius: 8,
				    fillColor: "#ff7800",
				    color: "#000",
				    weight: 1,
				    opacity: 1,
				    fillOpacity: 0.8
				};

				var myPoints = [{ "type": "Feature", "properties": { "codvia": "31110", "numportal": "28", "empresa": "FOVASA", "modelo": " ", "productor": "Domiciliaria", "tipo_carga": "Trasera", "tipo_resid": "Residuos Urbanos", "fecha_carga_sistema": "2019-06-03 08:57:22" }, "geometry": { "type": "Point", "coordinates": [ 39.46, -0.36 ] } },
{ "type": "Feature", "properties": { "codvia": "31110", "numportal": "18", "empresa": "FOVASA", "modelo": " ", "productor": "Domiciliaria", "tipo_carga": "Trasera", "tipo_resid": "Residuos Urbanos", "fecha_carga_sistema": "2019-06-03 08:57:22" }, "geometry": { "type": "Point", "coordinates": [ 729330.164, 4371574.6994 ] } },
{ "type": "Feature", "properties": { "codvia": "31110", "numportal": "22", "empresa": "FOVASA", "modelo": " ", "productor": "Domiciliaria", "tipo_carga": "Trasera", "tipo_resid": "Residuos Urbanos", "fecha_carga_sistema": "2019-06-03 08:57:22" }, "geometry": { "type": "Point", "coordinates": [ 729373.298499999567866, 4371570.0054 ] } },
{ "type": "Feature", "properties": { "codvia": "60690", "numportal": "22", "empresa": "FCC", "modelo": "ROS_ROCA", "productor": "DOMICILIARIA", "tipo_carga": "Lateral Derecha", "tipo_resid": "Residuos Urbanos", "fecha_carga_sistema": "2019-06-03 08:56:24" }, "geometry": { "type": "Point", "coordinates": [ 721296.680100000463426, 4375625.8584 ] } },
{ "type": "Feature", "properties": { "codvia": "67230", "numportal": "49", "empresa": "FCC", "modelo": "OTTO", "productor": "PERSONALIZADA", "tipo_carga": "Trasera", "tipo_resid": "Residuos Urbanos", "fecha_carga_sistema": "2019-06-03 08:56:24" }, "geometry": { "type": "Point", "coordinates": [ 728222.007399999536574, 4371049.4271 ] } },
]	
/*
				var myStyle = {
    "color": "#ff7800",
    "weight": 5,
    "opacity": 0.65
};
				var myLines = [{
    "type": "LineString",
    "coordinates": [[-100, 40], [-105, 45], [-110, 55]]
}, {
    "type": "LineString",
    "coordinates": [[-105, 40], [-110, 45], [-115, 55]]
}];
				
L.geoJSON(myLines, {
    style: myStyle
}).addTo(mymap);
*/
	
			var geojsonMarkerOptions = {
    radius: 8,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};

L.geoJSON(myPoints, {
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
    }
}).addTo(mymap);
				/*
				var geoData = getContainers(types[3]);
				console.log(geoData[0]);
				console.log(geoData[1]);
				console.log(geoData[2]);
				console.log(geoData[3]);
				console.log(geoData[4]);
				L.geoJSON(	geoData, {
				    pointToLayer: function (feature, latlng) {
				        return L.circleMarker(latlng, geojsonMarkerOptions);
				    }
				}).addTo(mymap);
				*/
				function getContainers(type) {
					// Get map in JSON form
					var mapObj = getData();
					// Parse JSON and only store containers of given type
					var mapFeatures = mapObj.features;
					var mapType = mapFeatures.filter(function (entry) {
						return entry.properties.tipo_resid === type; 
					}); 
					//	console.log(mapType);
					return mapType;
					/*	console.log(mapFeatures[0].properties.tipo_resid);
					for (var i = 0; i < mapFeatures.length; i++) {
						if (mapFeatures[i].properties.tipo_resid == type) {
						
							//console.log(mapFeatures[i].properties);
							// Add to resulting GeoJSON object

							mapType.append(mapFeatures[i]);
						}
					}	
						
					*/
				}


				function getData() {
					var mapObj = null;
					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function() {
						if (this.readyState == 4 && this.status == 200) {
							mapObj = JSON.parse(this.responseText);
							//document.getElementById("mapa").innerHTML = mapObj.features;
							//console.log(mapObj.features);
						}
					};
					xmlhttp.open('GET', 'http://mapas.valencia.es/lanzadera/opendata/res_contenedor/JSON', false);
					xmlhttp.send();
					return mapObj;
				}

			</script>
        </div>
        
        <footer>
            <div>
                <p>Tel. (+34) 555 - 555 - 555</p>
            </div>
            <div>
                <img alt='logo' src="img/fb.png">
                <img alt='logo' src="img/tw.png">
                <img alt='logo' src="img/in.png">
                <img alt='logo' src="img/mail.png">
            </div>
        </footer>
    </body>
</html>



